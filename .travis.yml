language: java
dist: trusty
jdk:
  - oraclejdk8

# -----------------
# Reference: https://docs.travis-ci.com/user/gui-and-headless-browsers/#Using-xvfb-to-Run-Tests-That-Require-a-GUI
before_script:
  - "export DISPLAY=:99.0"
  - "sh -e /etc/init.d/xvfb start"
  - sleep 3 # give xvfb some time to start
# -----------------

before_install:
  - mkdir -p $TRAVIS_BUILD_DIR/target/classes/resource/
  - echo "$JIDE_COMPANY_NAME" >> $TRAVIS_BUILD_DIR/target/classes/resource/jidelicense.txt
  - echo "$JIDE_PROJECT_NAME" >> $TRAVIS_BUILD_DIR/target/classes/resource/jidelicense.txt
  - echo "$JIDE_LICENSE_KEY" >> $TRAVIS_BUILD_DIR/target/classes/resource/jidelicense.txt
  - if [ -n "$TRAVIS_TAG" ]; then echo "$TRAVIS_TAG" >> $TRAVIS_BUILD_DIR/target/classes/resource/version.txt; fi
  - if [ "$TRAVIS_BRANCH" != "master" ]; then echo "$TRAVIS_BRANCH" >> $TRAVIS_BUILD_DIR/target/classes/resource/branch.txt; fi
  - if [ "$TRAVIS_BRANCH" != "master" ]; then echo "$TRAVIS_BUILD_NUMBER" >> $TRAVIS_BUILD_DIR/target/classes/resource/build.txt; fi
  - echo $(date +"%Y-%m-%d") >> $TRAVIS_BUILD_DIR/target/classes/resource/date.txt

before_deploy:
  - "mvn -DskipTests package"

deploy:
  provider: s3
  access_key_id: $S3_ACCESS_KEY_ID
  secret_access_key:
    secure: "Pp91agMoerJ2VfIjN6Y+exx9f/9Ncp6X6WMZkUTSDNkbSOXl8eX+HTlH6ji2GkskqCIpEonj5QYj9gptgzA0QJ2ZP+D3z05Rnnzd1Mmj6KpdXDRR6rmVi/5V0gz1IteqrdZx2ro0v7vDvAKujSouIP10HXCwgKBu92qvbmNkXmcpLCp4w7kyZ4h1w/BgeYa6JakgTT8TRWtuLHlUZ4Bo8Ei6aIjsTGvHF2S+XOV5g8tMs/hRIUW7sAsPvssQEKa/LJ6CFnPdYQn9H/3Oo3KWJGTZpXgjZ8wEeJqDdE5XDju/dvFbY1C3k30yblKDEpQMURU1EPhQTkc+rakxSZlGZio63jskZ/UOgNRY3H+jw1koSxi4pWw0xCSQ93qvqWwhycUQNASxwOBj/1f7HIdLSiL4OoTiCGzX8AdtGi/hSBrK92p1Ls95a6inwZrfF3EupTCCEXOnvoFp6qnkiiLbUJvYt0bJFuOoR6PFslKfEuNk+7CF9QIF+ZsfII9A8JOtDWfHF80RmtIWl0nn0njkjALWEHr2VvKS2h/ZnwdA8WiIA3J5VDAZnnDu4OxvJ44IcD3Ue1liYlfOviZuMiJLHdZR9ySZyLVggk5qmrFJzfFXNY5ZAjLGmPP3unSGSRAQ0E3VsICzdtnolPCh/2mLma+URRNPfvYUc8aRlDvfhrw="
  bucket: $S3_BUCKET
  region: $S3_REGION
  upload-dir: build/$TRAVIS_BRANCH
  local-dir: $TRAVIS_BUILD_DIR/target/build
  skip_cleanup: true
  acl: public_read
  on:
    repo: $DEPLOY_REPO
    tags: false
    all_branches: true
    jdk: oraclejdk8

deploy:
  provider: releases
  prerelease: true
  api_key:
    secure: "mA6DaAr2VXyE8Zn0LPq7XX3e3/Dnlk3trkNDhuWNbs4jCISbCLBJalJEaovgd392/tKYjmOdN7kN+PUVyOwQZgwl2v7Q4cx0epMksibLhjICvVegGRMM/epPaOBqrQXy31gZN6RDKxVG/XFw9K9ez3TUZr0GmsjaRjQ9rNL62eRwvywrNzNFHLDJAWtM4Jl/DijN1LHO17OcecQArRA/Dk8y2r52DlKBXqQlksqfr3slJOH2natY/Nf2ZkfEyYZNRZ+6J9uKbkCTFncVoN80V/1nlA9QQ17gJx5ZnhpWqytebMgdRBKHgVECuLRHfw7vUzkQkk3V9U/VMxYTassWYYcfV9PNWCSshL4czl5LjMzRU65M+H2l/pISFwpwFM4E5u7A8lJ4KWclgfU7vFn/iWkb95NeAbYvPOfvB4OGIiaSI8xTWWL/tKdX+hmjWIKPSdhQd8B26syfJeqL2DcgE8uFjgisLZuBlWl7dKr11ausTPcA8lu4A4dWsZpuBVIPT6/Oi0XEFYVaTiy3CSV/XVV1XORME6G3UC0098DlWW/sZw5dA6jv/cf0o4IwttYDZdNq8fQVL2aXM7uJpv54gAjtBUpoFb/nNnkMw6MuN/xSzcgKs/ZWQk3HSPNuSuiWi/XPftNPUYJIJsZCeZscfKIBupzUhU9W8NX4r+LmYHA="
  file: $TRAVIS_BUILD_DIR/target/build/voxelshop-bin.zip
  skip_cleanup: true
  on:
    repo: $DEPLOY_REPO
    branch: qa
    tags: true
    jdk: oraclejdk8

deploy:
  provider: releases
  api_key:
    secure: "mA6DaAr2VXyE8Zn0LPq7XX3e3/Dnlk3trkNDhuWNbs4jCISbCLBJalJEaovgd392/tKYjmOdN7kN+PUVyOwQZgwl2v7Q4cx0epMksibLhjICvVegGRMM/epPaOBqrQXy31gZN6RDKxVG/XFw9K9ez3TUZr0GmsjaRjQ9rNL62eRwvywrNzNFHLDJAWtM4Jl/DijN1LHO17OcecQArRA/Dk8y2r52DlKBXqQlksqfr3slJOH2natY/Nf2ZkfEyYZNRZ+6J9uKbkCTFncVoN80V/1nlA9QQ17gJx5ZnhpWqytebMgdRBKHgVECuLRHfw7vUzkQkk3V9U/VMxYTassWYYcfV9PNWCSshL4czl5LjMzRU65M+H2l/pISFwpwFM4E5u7A8lJ4KWclgfU7vFn/iWkb95NeAbYvPOfvB4OGIiaSI8xTWWL/tKdX+hmjWIKPSdhQd8B26syfJeqL2DcgE8uFjgisLZuBlWl7dKr11ausTPcA8lu4A4dWsZpuBVIPT6/Oi0XEFYVaTiy3CSV/XVV1XORME6G3UC0098DlWW/sZw5dA6jv/cf0o4IwttYDZdNq8fQVL2aXM7uJpv54gAjtBUpoFb/nNnkMw6MuN/xSzcgKs/ZWQk3HSPNuSuiWi/XPftNPUYJIJsZCeZscfKIBupzUhU9W8NX4r+LmYHA="
  file: $TRAVIS_BUILD_DIR/target/build/voxelshop-bin.zip
  skip_cleanup: true
  on:
    repo: $DEPLOY_REPO
    branch: master
    tags: true
    jdk: oraclejdk8