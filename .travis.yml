language: java
jdk:
  - oraclejdk8
  - oraclejdk7

before_install:
  - mkdir -p $TRAVIS_BUILD_DIR/target/classes/resource/
  - echo "$JIDE_COMPANY_NAME" >> $TRAVIS_BUILD_DIR/target/classes/resource/jidelicense.txt
  - echo "$JIDE_PROJECT_NAME" >> $TRAVIS_BUILD_DIR/target/classes/resource/jidelicense.txt
  - echo "$JIDE_LICENSE_KEY" >> $TRAVIS_BUILD_DIR/target/classes/resource/jidelicense.txt
  - if [ -n "$TRAVIS_TAG" ]; then echo "$TRAVIS_TAG" >> $TRAVIS_BUILD_DIR/target/classes/resource/version.txt; fi
  - if [ "$TRAVIS_BRANCH" != "master" ]; then echo "$TRAVIS_BRANCH" >> $TRAVIS_BUILD_DIR/target/classes/resource/branch.txt; fi
  - if [ "$TRAVIS_BRANCH" != "master" ]; then echo "$TRAVIS_BUILD_NUMBER" >> $TRAVIS_BUILD_DIR/target/classes/resource/build.txt; fi
  - echo $(date +"%Y-%m-%d") >> $TRAVIS_BUILD_DIR/target/classes/resource/date.txt

deploy:
  provider: s3
  access_key_id: $S3_ACCESS_KEY_ID
  secret_access_key: $S3_SECRET_ACCESS_KEY
  bucket: $S3_BUCKET
  region: $S3_REGION
  upload-dir: build/$TRAVIS_BRANCH
  local-dir: $TRAVIS_BUILD_DIR/target/build
  skip_cleanup: true
  acl: public_read
  on:
      branch: develop
      jdk: oraclejdk7

deploy:
  provider: releases
  prerelease: true
  file: $TRAVIS_BUILD_DIR/target/build/voxelshop-bin.zip
  on:
    repo: simlu/voxelshop
    branch: ci-prep
    tags: true